sudo: required
dist: trusty
language: python
python:
  - "3.4"
env:
  global:
    - DEBIAN_FRONTEND=noninteractive
services:
  - mongodb
  - postgresql
  - redis-server
  - rabbitmq-server
  - memcached
addons:
  postgresql: "9.4"
before_install:
  - sudo wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
  - sudo echo "deb http://packages.elastic.co/elasticsearch/2.0/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elastic.list
  - sudo apt-get update
  - sudo apt-get install -y elasticsearch

  - sleep 10

  - psql --version
  - echo exit | mongo
  - redis-cli "INFO" | grep version
  - curl -XGET "localhost:9200"
  - rabbitmqctl status | grep -ai '"rabbitmq"'
  - memcached -h | grep memcached | grep 1
  - which pip
install:
  - pip install virtualenv
  - virtualenv env3
  - source env3/bin/activate
  - pip install -U pip
  - pip install -U setuptools
  - pip install -r requirements.txt
  - pip install -r requirements-dev.txt
before_script:
  - psql -c "create database app;" -U postgres
script:
  - flake8 app
  - frosted -r app
  - isort --check-only -rc app --diff
  - cd app
  - python manage.py check
  - python manage.py test -v 2 --with-coverage
notifications:
  email: false
